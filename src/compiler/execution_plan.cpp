
#include "execution_plan.h"

namespace furious {

FccOperator::FccOperator(FccOperatorType type) : 
m_type(type) 
{

}

////////////////////////////////////////////////
////////////////////////////////////////////////
////////////////////////////////////////////////

Scan::Scan(QualType component) : 
  FccOperator(FccOperatorType::E_SCAN), 
  m_component(component) {

}

////////////////////////////////////////////////
////////////////////////////////////////////////
////////////////////////////////////////////////

Join::Join(FccOperator* left, 
           FccOperator* right) :
FccOperator(FccOperatorType::E_JOIN),
p_left(left),
p_right(right) 
{

}

Join::~Join() {
  if(p_left != nullptr) {
    delete p_left;
  }

  if(p_right != nullptr) {
    delete p_right;
  }
}

////////////////////////////////////////////////
////////////////////////////////////////////////
////////////////////////////////////////////////

Filter::Filter( FccOperator* child) :
FccOperator(FccOperatorType::E_FILTER),
p_child(child) 
{

}

Filter::~Filter() 
{
  if(p_child != nullptr) {
    delete p_child;
  }
}

////////////////////////////////////////////////
////////////////////////////////////////////////
////////////////////////////////////////////////

PredicateFilter::PredicateFilter(FccOperator* child, 
                                 const FunctionDecl* func_decl) :
Filter(child),
p_func_decl{func_decl}
{
}

////////////////////////////////////////////////
////////////////////////////////////////////////
////////////////////////////////////////////////


TagFilter::TagFilter(FccOperator* child,
                     const std::string& tag,
                     FccFilterOpType op_type) :
Filter{child},
m_tag{tag},
m_op_type{op_type}
{

}

////////////////////////////////////////////////
////////////////////////////////////////////////
////////////////////////////////////////////////

ComponentFilter::ComponentFilter(FccOperator* child,
                                 QualType component_type,
                                 FccFilterOpType op_type) :
Filter{child},
m_component_type{component_type},
m_op_type{op_type}
{

}

////////////////////////////////////////////////
////////////////////////////////////////////////
////////////////////////////////////////////////

Foreach::Foreach(FccOperator* child,
                 const std::vector<const FccSystemInfo*>& systems) :
  FccOperator{FccOperatorType::E_FOREACH}, 
  m_systems{systems}, 
  p_child{child} {

  }

Foreach::~Foreach() {
  if(p_child != nullptr) {
    delete p_child;
  }
}

////////////////////////////////////////////////
////////////////////////////////////////////////
////////////////////////////////////////////////


ExecPlan::ExecPlan(FccContext* context) :
p_context{context}
{

}

ExecPlan::~ExecPlan()
{
  for(auto root : m_roots)
  {
    delete root;
  }
}


} /* furious */ 
